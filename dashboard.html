<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MONE ¬∑ Panel</title>
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#1f7a3a">
  <link rel="icon" href="logo.png">
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div id="busyBar" class="busy" style="display:none;">
    <div class="spinner"></div>
    <div id="busyText">Cargando‚Ä¶</div>
  </div>
  <div id="toast" class="toast" style="display:none;">‚Äî</div>

  <div class="shell">
    <div class="header">
      <div class="brand">
        <img src="logo.png" alt="MONE">
        <div>
          <div class="title">MONE</div>
          <div class="sub" id="whoami">‚Äî</div>
        </div>
      </div>

      <div class="header-actions">
        <button class="btn ghost" onclick="moneOpenOnboarding()">C√≥mo funciona</button>
        <button class="btn danger" onclick="moneLogout()">Salir</button>
      </div>
    </div>

    <div class="stack">
      <!-- ACOMPA√ëADO -->
      <section class="card" id="view-acompa√±ado" style="display:none;">
        <div style="display:flex;justify-content:space-between;gap:10px;flex-wrap:wrap;align-items:flex-start;">
          <div>
            <h2 class="h2">Pedir acompa√±amiento</h2>
            <div class="muted small" id="wizProgress">Paso 1 de 3</div>
          </div>
        </div>

        <!-- Step 1 -->
        <div id="wizStep1" style="margin-top:12px;">
          <div class="muted">¬øPara qu√© necesitas ayuda?</div>
          <div class="tilegrid">
            <button class="tile" type="button" data-wiztype="Cita m√©dica" onclick="wizPickType('Cita m√©dica')">
              <div class="ico">üè•</div><div class="txt">Cita m√©dica</div>
            </button>
            <button class="tile" type="button" data-wiztype="Gesti√≥n administrativa" onclick="wizPickType('Gesti√≥n administrativa')">
              <div class="ico">üßæ</div><div class="txt">Gesti√≥n</div>
            </button>
            <button class="tile" type="button" data-wiztype="Compra / recados" onclick="wizPickType('Compra / recados')">
              <div class="ico">üõí</div><div class="txt">Compra</div>
            </button>
            <button class="tile" type="button" data-wiztype="Paseo / movilidad activa" onclick="wizPickType('Paseo / movilidad activa')">
              <div class="ico">üö∂</div><div class="txt">Paseo</div>
            </button>
            <button class="tile" type="button" data-wiztype="Acompa√±amiento social" onclick="wizPickType('Acompa√±amiento social')">
              <div class="ico">üí¨</div><div class="txt">Social</div>
            </button>
          </div>
        </div>

        <!-- Step 2 -->
        <div id="wizStep2" style="display:none;margin-top:12px;">
          <div class="muted">Elige el d√≠a</div>
          <input id="wizDate" class="input" type="date" />
          <div class="actions">
            <button class="btn ghost" onclick="wizBack()">Atr√°s</button>
            <button class="btn primary" onclick="wizNextFromDate()">Siguiente</button>
          </div>
        </div>

        <!-- Step 3 -->
        <div id="wizStep3" style="display:none;margin-top:12px;">
          <div class="muted">Elige la hora</div>
          <input id="wizTime" class="input" type="time" />
          <label class="label">Nota (opcional)</label>
          <input id="wizNotes" class="input" placeholder="Ej. silla de ruedas, lugar exacto‚Ä¶" />
          <div class="actions">
            <button class="btn ghost" onclick="wizBack()">Atr√°s</button>
            <button class="btn primary" onclick="wizNextFromTime()">Siguiente</button>
          </div>
        </div>

        <!-- Confirm -->
        <div id="wizStep4" style="display:none;margin-top:12px;">
          <div class="muted">Revisa y confirma</div>
          <div class="card" style="box-shadow:none;border-radius:18px;border:1px solid var(--border);padding:14px;margin-top:10px;">
            <div class="small muted">Tu solicitud</div>
            <div id="wizSummary" style="font-weight:900;margin-top:6px;">‚Äî</div>
          </div>
          <div class="actions">
            <button class="btn ghost" onclick="wizBack()">Atr√°s</button>
            <button class="btn primary" onclick="wizConfirm()">Confirmar</button>
          </div>
        </div>
      </section>

      <section class="card" id="view-acompa√±ado-list" style="display:none;">
        <h2 class="h2">Mis solicitudes</h2>
        <div class="list" id="myRequests"></div>
      </section>

      <!-- ACOMPA√ëANTE -->
      <section class="card" id="view-acompa√±ante" style="display:none;">
        <h2 class="h2">Solicitudes en tu barrio</h2>
        <p class="p muted small">Acepta una solicitud si est√°s disponible.</p>
        <div class="list" id="availableRequests"></div>

        <div style="height:12px;"></div>

        <h2 class="h2">Mis acompa√±amientos</h2>
        <div class="list" id="myAssignmentsActive"></div>
      </section>

      <!-- ADMIN -->
      <section class="card" id="view-admin" style="display:none;">
        <h2 class="h2">Verificaci√≥n de acompa√±antes</h2>
        <p class="p muted small">Solo verificados pueden aceptar solicitudes.</p>
        <div class="list" id="adminUsers"></div>
      </section>
    </div>
  </div>

  <!-- Onboarding modal -->
  <div class="modalOverlay" id="onboardOverlay" aria-hidden="true">
    <div class="modal">
      <div class="modalTop">
        <div style="font-weight:900;">C√≥mo funciona MONE</div>
        <button class="btn link" onclick="moneCloseOnboarding()">Cerrar</button>
      </div>

      <div class="dots" id="onDots">
        <div class="dot on"></div><div class="dot"></div><div class="dot"></div>
      </div>

      <div class="slide on" id="slide1">
        <h3>1) Pide ayuda en 3 pasos</h3>
        <p>Elige el tipo, el d√≠a y la hora. Confirmas y listo.</p>
      </div>

      <div class="slide" id="slide2">
        <h3>2) Un acompa√±ante lo acepta</h3>
        <p>Si hay voluntarios verificados en tu barrio, uno aceptar√° tu solicitud.</p>
      </div>

      <div class="slide" id="slide3">
        <h3>3) Finalizar y valorar</h3>
        <p>El acompa√±ante marca finalizado, t√∫ lo confirmas y ambos valor√°is con estrellas.</p>
      </div>

      <div class="actions" style="justify-content:space-between;">
        <button class="btn ghost" onclick="moneOnPrev()">Atr√°s</button>
        <button class="btn primary" id="onNextBtn" onclick="moneOnNext()">Siguiente</button>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
  <script>
    window.addEventListener("load", () => {
      moneBootDashboard();
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("./service-worker.js").catch(()=>{});
      }
    });
  </script>
</body>
</html>
